<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DexGuard – SOL Restart (STEP 1)</title>
  <style>
    /* KEEP YOUR EXISTING THEME / LAYOUT CSS HERE */
    body{margin:0;background:#0b1020;color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto}
    .wrap{padding:16px}
    .row{display:flex;gap:12px;align-items:center}
    .card{background:#0f1530;border-radius:14px;padding:14px}
    .muted{opacity:.7}
    .btn{padding:8px 12px;border-radius:10px;background:#1b2250;color:#fff;border:0}
    #chart{height:360px}
    #trades{max-height:280px;overflow:auto}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row">
      <button class="btn" id="btn-load">Load SOL Token</button>
      <span class="muted" id="status">idle</span>
    </div>

```
<div class="card" style="margin-top:12px">
  <div class="row"><strong>Chart</strong></div>
  <div id="chart" class="muted">(chart renders here)</div>
</div>

<div class="card" style="margin-top:12px">
  <div class="row"><strong>Live Trades</strong></div>
  <div id="trades" class="muted"></div>
</div>
```

  </div>

<script>
// ===================== CONFIG =====================
// Your Cloudflare Worker base
const BDS = 'https://flat-grass-9c26solanaonsolana.simon-kaggwa-why.workers.dev/bds';
// Known-good SOL token mint for testing (PEPE example)
const TEST_MINT = 'B5WTLaRwaUQpKk7ir1wniNB6m5o8GgMrimhKM';

// ===================== HELPERS =====================
async function fetchJson(url){
  const r = await fetch(url);
  if(!r.ok) throw new Error(r.status);
  return r.json();
}

function solMintFromState(){
  // STEP 1: fixed mint (proves pipeline works)
  return TEST_MINT;
}

// ===================== BIRDEYE CALLS =====================
async function bdsOhlcv(tf='15m', bars=300){
  const mint = solMintFromState();
  const type = tf;
  const now = Math.floor(Date.now()/1000);
  const secPer = tf==='1m'?60:tf==='5m'?300:tf==='15m'?900:3600;
  const from = now - bars*secPer;
  const url = `${BDS}/defi/ohlcv?address=${encodeURIComponent(mint)}&type=${type}&time_from=${from}&time_to=${now}`;
  const j = await fetchJson(url);
  const items = j?.data?.items || [];
  return items.map(x=>({
    time: x.unix_time,
    open: x.o, high: x.h, low: x.l, close: x.c, volume: x.v
  }));
}

async function bdsTrades(limit=50){
  const mint = solMintFromState();
  const url = `${BDS}/defi/txs/token?address=${encodeURIComponent(mint)}&offset=0&limit=${limit}`;
  const j = await fetchJson(url);
  return j?.data?.items || [];
}

// ===================== RENDER =====================
function renderChart(candles){
  const el = document.getElementById('chart');
  el.textContent = `Candles loaded: ${candles.length}`;
}

function renderTrades(items){
  const el = document.getElementById('trades');
  el.innerHTML = items.map(t=>{
    const side = t.side || 'swap';
    const usd = t.volumeUsd || t.valueUsd || '';
    return `<div>${side} · $${usd}</div>`;
  }).join('');
}

// ===================== BOOT =====================
document.getElementById('btn-load').onclick = async ()=>{
  const s = document.getElementById('status');
  try{
    s.textContent = 'loading…';
    const candles = await bdsOhlcv('15m', 300);
    renderChart(candles);
    const trades = await bdsTrades(50);
    renderTrades(trades);
    s.textContent = 'ok';
  }catch(e){
    s.textContent = 'error';
    console.error(e);
  }
};
</script>

</body>
</html>
